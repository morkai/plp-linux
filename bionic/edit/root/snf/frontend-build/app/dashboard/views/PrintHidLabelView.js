// Part of <https://miracle.systems/p/walkner-snf> licensed under <CC BY-NC-SA 4.0>

define(["app/controller","app/viewport","app/core/View","app/core/util/uuid","app/dashboard/templates/printHidLabel"],function(e,t,i,s,o){"use strict";return i.extend({template:o,events:{submit:"onSubmit"},afterRender:function(){this.model.lastTest?(this.$id("orderNo").val(this.model.lastTest.get("orderNo")),this.$id("serialNo").val(this.model.lastTest.get("serialNo"))):this.$id("orderNo").val(e.tags.getValue("currentOrder")||"")},onDialogShown:function(){this.closeDialog=t.closeDialog.bind(t),this.$id("orderNo").focus()},onSubmit:function(i){i.preventDefault();var o=this,r=o.$id("submit").prop("disabled",!0),a=o.ajax({method:"POST",url:"/snf/tests;printHidLabel",data:JSON.stringify({requestId:s(),prodLine:e.tags.getValue("prodLine"),orderNo:this.$id("orderNo").val(),serialNo:parseInt(this.$id("serialNo").val(),10)})});a.fail(function(){"abort"!==a.statusText&&(r.prop("disabled",!1),t.msg.show({type:"error",time:3e3,text:o.t("printHidLabel:failure")}))}),a.done(function(){o.closeDialog(),t.msg.show({type:"success",time:2500,text:o.t("printHidLabel:success")})})}})});