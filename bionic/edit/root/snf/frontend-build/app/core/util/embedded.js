// Part of <https://miracle.systems/p/walkner-snf> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport","app/core/View","app/core/views/DialogView","app/core/templates/embedded/appsDialog","app/core/templates/embedded/confirmDialog","app/core/templates/embedded/actions"],function(e,t,n,o,a,s,i,p){"use strict";function r(e){var t=e.data;switch(t.type){case"apps":d(t.data)}}function d(e){clearTimeout(c),0!==e.apps.length&&(1===e.apps.length?window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*"):w(e.apps))}function w(e){n.showDialog(new o({events:{"click [data-app]":function(e){n.closeAllDialogs(),window.parent.postMessage({type:"switch",app:window.WMES_APP_ID,newApp:e.currentTarget.dataset.app},"*")}},dialogClassName:"embedded-appsDialog",template:s,getTemplateData:function(){return{apps:e}}}))}var c=null;return window.addEventListener("message",r),{actions:{switch:function(){window.parent.postMessage({type:"apps"},"*"),c&&clearTimeout(c),c=setTimeout(function(){window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*")},250)},config:function(){window.parent.postMessage({type:"config"},"*")},refresh:function(){window.parent.postMessage({type:"refresh"},"*")},resetBrowser:function(){window.parent.postMessage({type:"resetBrowser"},"*")},restartBrowser:function(){window.parent.postMessage({type:"restartBrowser"},"*")},noKiosk:function(){window.parent.postMessage({type:"noKiosk"},"*")},reboot:function(){var e=new a({dialogClassName:"embedded-confirmDialog",template:i,model:{action:"reboot"}});e.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"reboot"},"*")}),n.showDialog(e,t("core","embedded:reboot:title"))},shutdown:function(){var e=new a({dialogClassName:"embedded-confirmDialog",template:i,model:{action:"shutdown"}});e.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"shutdown"},"*")}),n.showDialog(e,t("core","embedded:shutdown:title"))}},render:function(t,n){function o(e){r.find(".dev").toggleClass("hidden",e)}if(window.parent!==window){var a=0,s=null,i=this.actions,r=e(p({app:window.WMES_APP_ID,left:n&&!0===n.left}));r.on("click","[data-action]",function(e){var t=i[e.currentTarget.dataset.action];t&&t(),e.preventDefault()}),r.on("show.bs.dropdown",function(){a+=1,clearTimeout(s),s=setTimeout(function(){a=0},2e3),o(a<3)}),r.on("hidden.bs.dropdown",function(){o(!0)}),(n&&n.container||t.$el).append(r)}}}});