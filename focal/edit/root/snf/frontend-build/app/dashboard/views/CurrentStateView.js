// Part of <https://miracle.systems/p/walkner-snf> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/user","app/controller","app/core/View","app/dashboard/templates/currentState"],function(t,e,a,r,i,u,n,s){"use strict";return n.extend({template:s,localTopics:{"controller.valuesChanged":function(e){t.forEach(e,this.updateState,this)}},initialize:function(){this.idPrefix=t.uniqueId("currentState")},destroy:function(){},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){this.updateTagValue("current"),this.updateTagValue("voltage"),this.updateTagValue("temperature"),this.updateTagValue("light.1"),this.updateTagValue("light.2"),this.updateCurrentExtremes(!0),this.updateLightExtremes(!0),this.updateTotalDuration()},updateState:function(t,e){switch(e){case"light.1":case"light.2":case"current":case"voltage":case"temperature":this.updateTagValue(e);break;case"program.current.min":case"program.current.max":this.updateCurrentExtremes();break;case"light.1.min.pc":case"light.2.min.pc":this.updateLightExtremes();break;case"program.hrsDuration":case"program.hrsCount.pc":case"program.hrsInterval.pc":case"program.duration.pc":return void this.updateTotalDuration()}},$tag:function(t){return this.$('.currentState-tag[data-tag="'+t+'"]')},updateTagValue:function(t,e){void 0===e&&(e=Math.max(u.tags.getValue(t),0));var a=this.$tag(t).find(".currentState-tag-value"),r=a.attr("data-suffix"),i=parseInt(a.attr("data-decimals")||0);isNaN(e)&&"number"==typeof e?e="?":i>0&&(e=e.toFixed(i)),"?"!==e&&r&&r.length&&(e+=r),a.text(e)},updateCurrentExtremes:function(t){this.updateTagExtreme("current","min","program.current.min",t),this.updateTagExtreme("current","max","program.current.max",t)},updateLightExtremes:function(t){this.updateTagExtreme("light.1","min","light.1.min.plc",t),this.updateTagExtreme("light.2","min","light.2.min.plc",t)},updateTagExtreme:function(t,e,a,r){var i=u.tags.getValue(a),n=this.$tag(t).find(".currentState-tag-extreme.is-"+e);n.text(i),n[i>0?r?"show":"fadeIn":r?"hide":"fadeOut"]()},updateTotalDuration:function(){var t=u.tags.getValue("program.duration.pc"),e=u.tags.getValue("program.hrsCount.pc"),a=u.tags.getValue("program.hrsDuration");t+=(u.tags.getValue("program.hrsInterval.pc")+a)*e,this.updateTagValue("totalDuration",r.toString(t,!0))}})});